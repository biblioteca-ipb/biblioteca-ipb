<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Biblioteca IPB Petr√≥polis</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <style>
        :root { --primary: #006437; --accent: #2ecc71; --bg: #f4f7f4; --white: #ffffff; --text: #2c3e50; --danger: #e74c3c; }
        body { font-family: system-ui, -apple-system, sans-serif; margin: 0; background: var(--bg); color: var(--text); padding-bottom: 80px; }
        header { background: var(--white); padding: 15px; text-align: center; border-bottom: 3px solid var(--primary); }
        .container { padding: 15px; max-width: 500px; margin: 0 auto; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: var(--white); padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 12px; }
        .btn-principal { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        nav { display: flex; background: var(--white); position: fixed; bottom: 0; width: 100%; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        nav button { flex: 1; padding: 15px; border: none; background: none; font-weight: bold; color: #7f8c8d; cursor: pointer; }
        nav button.active { color: var(--primary); border-top: 3px solid var(--primary); }
        .livro-item { background: white; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary); }
    </style>
</head>
<body>

<header>
    <h2>Biblioteca IPB Bairro Petr√≥polis</h2>
</header>

<div class="container">
    <section id="catalogo" class="section active">
        <h3 style="color: var(--primary);">üåø Livros Dispon√≠veis</h3>
        <div id="lista-catalogo">Conectando ao banco de dados...</div>
    </section>

    <section id="conta" class="section">
        <div id="area-login">
            <div class="card">
                <h3>Acessar Conta</h3>
                <input type="text" id="login-nome" placeholder="Seu Nome Completo">
                <button class="btn-principal" onclick="loginMembro()">Entrar</button>
            </div>
        </div>
        <div id="perfil-membro" style="display:none;">
            <div class="card">
                <h3>Ol√°, <span id="nome-exibicao"></span></h3>
                <div id="meus-livros"></div>
                <button onclick="logout()" class="btn-principal" style="background:var(--danger); margin-top:20px;">Sair</button>
            </div>
        </div>
    </section>

    <section id="admin" class="section">
        <div id="area-adm-login" class="card">
            <h3>Painel do Di√°cono</h3>
            <input type="password" id="adm-pass" placeholder="Senha (padr√£o: ipb123)">
            <button class="btn-principal" onclick="loginAdmin()">Entrar no Painel</button>
        </div>
        <div id="painel-adm" style="display:none;">
            <div class="card">
                <h4>‚ûï Novo Livro</h4>
                <input type="text" id="novo-titulo" placeholder="T√≠tulo do Livro">
                <button class="btn-principal" onclick="addLivro()">Salvar Livro</button>
            </div>
            <div id="lista-adm" class="card"><h4>Loca√ß√µes</h4></div>
        </div>
    </section>
</div>

<nav>
    <button onclick="mudarAba('catalogo')" id="nav-catalogo" class="active">LIVROS</button>
    <button onclick="mudarAba('conta')" id="nav-conta">CONTA</button>
    <button onclick="mudarAba('admin')" id="nav-admin">ADM</button>
</nav>

<script>
    // Configura√ß√µes do seu Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCea0_d_WrJKIyvyCvBsjH68hH9-BlY7M0",
        authDomain: "biblioteca-ipb.firebaseapp.com",
        databaseURL: "https://biblioteca-ipb-default-rtdb.firebaseio.com",
        projectId: "biblioteca-ipb",
        storageBucket: "biblioteca-ipb.firebasestorage.app",
        messagingSenderId: "140869477812",
        appId: "1:140869477812:web:d4a57845136c2958403ee1"
    };

    // Inicializa√ß√£o segura
    try {
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();
        console.log("Firebase conectado com sucesso.");
    } catch (e) {
        console.error("Erro ao conectar Firebase:", e);
        alert("Erro de conex√£o. Verifique se o Firebase est√° configurado corretamente.");
    }

    function mudarAba(aba) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(aba).classList.add('active');
        document.getElementById('nav-' + aba).classList.add('active');
    }

    function loginAdmin() {
        const pass = document.getElementById('adm-pass').value;
        console.log("Tentativa de login ADM...");
        if(pass === "ipb123") {
            document.getElementById('area-adm-login').style.display = 'none';
            document.getElementById('painel-adm').style.display = 'block';
        } else {
            alert("Senha Incorreta! Tente 'ipb123'");
        }
    }

    function addLivro() {
        const t = document.getElementById('novo-titulo').value;
        if(t) {
            db.ref('livros').push({ titulo: t, status: 'disponivel' })
            .then(() => { alert("Livro Salvo!"); document.getElementById('novo-titulo').value = ''; })
            .catch((e) => alert("Erro ao salvar: " + e.message));
        }
    }

    // Listener de livros
    db.ref('livros').on('value', (snap) => {
        const livros = snap.val();
        const lista = document.getElementById('lista-catalogo');
        lista.innerHTML = '';
        if(!livros) { lista.innerHTML = "Nenhum livro cadastrado."; return; }
        for(let id in livros) {
            lista.innerHTML += `<div class="livro-item">
                ${livros[id].titulo} 
                <button class="btn-principal" style="width:auto; padding:5px 10px;" onclick="reservar('${id}', '${livros[id].titulo}')" ${livros[id].status !== 'disponivel' ? 'disabled' : ''}>
                    ${livros[id].status === 'disponivel' ? 'Pegar' : 'Locado'}
                </button>
            </div>`;
        }
    });

    function loginMembro() {
        const n = document.getElementById('login-nome').value;
        if(n) {
            localStorage.setItem('ipb_user', n);
            location.reload();
        }
    }

    const user = localStorage.getItem('ipb_user');
    if(user) {
        document.getElementById('area-login').style.display = 'none';
        document.getElementById('perfil-membro').style.display = 'block';
        document.getElementById('nome-exibicao').innerText = user;
    }

    function logout() { localStorage.removeItem('ipb_user'); location.reload(); }
</script>
</body>
</html>
